<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Data Pegawai</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div class="container">
      <h2 class="text-center my-4">Edit Data Pegawai</h2>
      <form id="edit-form">
        <!-- Input teks -->
        <div class="form-group mb-3">
          <label for="nama">Nama</label>
          <input
            type="text"
            class="form-control"
            id="nama"
            name="nama"
            required
          />
        </div>
        <div class="form-group mb-3">
          <label for="nip">NIP</label>
          <input
            type="text"
            class="form-control"
            id="nip"
            name="nip"
            readonly
          />
        </div>
        <div class="form-group mb-3">
          <label for="ttl">Tempat dan Tanggal Lahir</label>
          <input type="text" class="form-control" id="ttl" name="ttl" />
        </div>
        <div class="form-group mb-3">
          <label for="golongan">Golongan</label>
          <select class="form-select" id="golongan" name="golongan">
            <option value="II/a">II/a</option>
            <option value="II/b">II/b</option>
            <option value="II/c">II/c</option>
            <option value="II/d">II/d</option>
            <option value="III/a">III/a</option>
            <option value="III/b">III/b</option>
            <option value="III/c">III/c</option>
            <option value="III/d">III/d</option>
            <option value="IV/a">IV/a</option>
            <option value="IV/b">IV/b</option>
            <option value="IV/c">IV/c</option>
            <option value="IV/d">IV/d</option>
          </select>
        </div>
        <div class="form-group mb-3">
          <label for="unitKerja">Unit Kerja</label>
          <input
            type="text"
            class="form-control"
            id="unitKerja"
            name="unitKerja"
          />
        </div>

        <!-- Checkbox untuk nilai TRUE/FALSE -->
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="skCpns"
            name="skCpns"
          />
          <label class="form-check-label" for="skCpns">SK CPNS</label>
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="skPns"
            name="skPns"
          />
          <label class="form-check-label" for="skPns">SK PNS</label>
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="skKenaikanPangkat"
            name="skKenaikanPangkat"
          />
          <label class="form-check-label" for="skKenaikanPangkat"
            >SK Kenaikan Pangkat</label
          >
        </div>
        <div class="form-group mb-3">
          <label for="tanggalSkKenaikanPangkat"
            >Tanggal SK Kenaikan Pangkat</label
          >
          <input
            type="date"
            class="form-control"
            id="tanggalSkKenaikanPangkat"
            name="tanggalSkKenaikanPangkat"
          />
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="skJabatan"
            name="skJabatan"
          />
          <label class="form-check-label" for="skJabatan">SK Jabatan</label>
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="stpplStruktural"
            name="stpplStruktural"
          />
          <label class="form-check-label" for="stpplStruktural"
            >STPPL (Diklat Struktural)</label
          >
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="stpplTeknis"
            name="stpplTeknis"
          />
          <label class="form-check-label" for="stpplTeknis"
            >STPPL (Diklat Teknis/Fungsional)</label
          >
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="ijazah"
            name="ijazah"
          />
          <label class="form-check-label" for="ijazah"
            >Ijazah Pendidikan Terakhir</label
          >
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="karisKarsu"
            name="karisKarsu"
          />
          <label class="form-check-label" for="karisKarsu">Karis/Karsu</label>
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="kartuTaspen"
            name="kartuTaspen"
          />
          <label class="form-check-label" for="kartuTaspen">Kartu Taspen</label>
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="skKonversiNip"
            name="skKonversiNip"
          />
          <label class="form-check-label" for="skKonversiNip"
            >SK Konversi NIP</label
          >
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="gajiberkala"
            name="gajiberkala"
          />
          <label class="form-check-label" for="gajiberkala"
            >Kenaikan Gaji Berkala</label
          >
        </div>
        <div class="form-group mb-3">
          <label for="tanggalKenaikanGajiBerkala"
            >Tanggal Kenaikan Gaji Berkala</label
          >
          <input
            type="date"
            class="form-control"
            id="tanggalKenaikanGajiBerkala"
            name="tanggalKenaikanGajiBerkala"
          />
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="kpeKarpeg"
            name="kpeKarpeg"
          />
          <label class="form-check-label" for="kpeKarpeg">KPE dan Karpeg</label>
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="skMutasi"
            name="skMutasi"
          />
          <label class="form-check-label" for="skMutasi"
            >SK Mutasi (Jika Ada)</label
          >
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="satyaLencana"
            name="satyaLencana"
          />
          <label class="form-check-label" for="satyaLencana"
            >Satya Lencana</label
          >
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="aktaNikah"
            name="aktaNikah"
          />
          <label class="form-check-label" for="aktaNikah">Akta Nikah</label>
        </div>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            class="form-check-input"
            id="npwp"
            name="npwp"
          />
          <label class="form-check-label" for="npwp">NPWP</label>
        </div>

        <!-- Input tanggal -->

        <!-- Tombol -->
        <button type="submit" class="btn btn-success mb-5">Simpan</button>
        <a href="index.html" class="btn btn-secondary mb-5">Batal</a>
      </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      function formatDateForInput(dateString) {
        if (!dateString) return ""; // Jika data kosong, kembalikan string kosong
        return dateString.split("T")[0]; // Ambil hanya bagian tanggal sebelum "T"
      }
      // Ambil parameter id dari URL
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id");

      // URL API Google Apps Script
      const apiUrl = `https://script.google.com/macros/s/AKfycbzZc_wtXGC0A8vIeqqA1BVb_0gMaCplZRZPSv4FLSiADVEw3ZyldYLL1UH2ZpzO7cvj/exec?id=${id}`;

      // Muat data untuk diedit
      fetch(apiUrl)
        .then((response) => response.json())
        .then((data) => {
          if (data.error) {
            alert("Data tidak ditemukan!");
          } else {
            // Isi nilai input berdasarkan data yang diambil
            document.getElementById("nama").value = data.Nama || "";
            document.getElementById("nip").value = data.NIP || "";
            document.getElementById("ttl").value =
              data["Tempat dan Tanggal Lahir"] || "";
            document.getElementById("golongan").value =
              data["Pangkat / Gol Ruang"] || "";
            document.getElementById("unitKerja").value =
              data["Unit Kerja"] || "";

            // Checkbox untuk TRUE/FALSE
            document.getElementById("skCpns").checked =
              data["SK CPNS"] === true;
            document.getElementById("skPns").checked = data["SK PNS"] === true;
            document.getElementById("skKenaikanPangkat").checked =
              data["SK Kenaikan Pangkat"] === true;
            document.getElementById("skJabatan").checked =
              data["SK Jabatan"] === true;
            document.getElementById("stpplStruktural").checked =
              data["STPPL (Diklat Struktural)"] === true;
            document.getElementById("stpplTeknis").checked =
              data["STPPL (Diklat Teknis/ Fungsional)"] === true;
            document.getElementById("ijazah").checked =
              data["Ijazah Pendidikan Terakhir"] === true;
            document.getElementById("karisKarsu").checked =
              data["Karis/ Karsu"] === true;
            document.getElementById("kartuTaspen").checked =
              data["Kartu Taspen"] === true;
            document.getElementById("skKonversiNip").checked =
              data["SK Konversi NIP"] === true;
            document.getElementById("gajiberkala").checked =
              data["Kenaikan Gaji Berkala"] === true;
            document.getElementById("kpeKarpeg").checked =
              data["KPE dan Karpeg"] === true;
            document.getElementById("skMutasi").checked =
              data["SK Mutasi (jika ada)"] === true;
            document.getElementById("satyaLencana").checked =
              data["Satya Lencana"] === true;
            document.getElementById("aktaNikah").checked =
              data["Akta Nikah"] === true;
            document.getElementById("npwp").checked = data["NPWP"] === true;

            // Input tanggal
            document.getElementById("tanggalSkKenaikanPangkat").value =
              formatDateForInput(data["Tanggal SK Kenaikan Pangkat"]);
            document.getElementById("tanggalKenaikanGajiBerkala").value =
              formatDateForInput(data["Tanggal Kenaikan Gaji Berkala"]);
          }
        })
        .catch((error) => console.error("Error fetching data:", error));

      // Simpan perubahan data
      document
        .getElementById("edit-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          Swal.fire({
            title: "Konfirmasi",
            text: "Apakah Anda yakin ingin menyimpan data?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Ya, simpan",
            cancelButtonText: "Tidak",
          }).then((result) => {
            if (result.isConfirmed) {
              const updatedData = {
                action: "ubah",
                nama: document.getElementById("nama").value,
                nip: document.getElementById("nip").value,
                ttl: document.getElementById("ttl").value,
                golongan: document.getElementById("golongan").value,
                unitKerja: document.getElementById("unitKerja").value,
                skCpns: document.getElementById("skCpns").checked,
                skPns: document.getElementById("skPns").checked,
                skKenaikanPangkat:
                  document.getElementById("skKenaikanPangkat").checked,
                tanggalSkKenaikanPangkat: document.getElementById(
                  "tanggalSkKenaikanPangkat"
                ).value,
                skJabatan: document.getElementById("skJabatan").checked,
                stpplStruktural:
                  document.getElementById("stpplStruktural").checked,
                stpplTeknis: document.getElementById("stpplTeknis").checked,
                ijazah: document.getElementById("ijazah").checked,
                karisKarsu: document.getElementById("karisKarsu").checked,
                kartuTaspen: document.getElementById("kartuTaspen").checked,
                skKonversiNip: document.getElementById("skKonversiNip").checked,
                gajiberkala: document.getElementById("gajiberkala").value,
                tanggalKenaikanGajiBerkala: document.getElementById(
                  "tanggalKenaikanGajiBerkala"
                ).value,
                kpeKarpeg: document.getElementById("kpeKarpeg").checked,
                skMutasi: document.getElementById("skMutasi").checked,
                satyaLencana: document.getElementById("satyaLencana").checked,
                aktaNikah: document.getElementById("aktaNikah").checked,
                npwp: document.getElementById("npwp").checked,
              };
              fetch(
                "https://script.google.com/macros/s/AKfycbzZc_wtXGC0A8vIeqqA1BVb_0gMaCplZRZPSv4FLSiADVEw3ZyldYLL1UH2ZpzO7cvj/exec?",
                {
                  method: "POST",
                  body: JSON.stringify(updatedData),
                  headers: {
                    "Content-Type": "application/json", // Header penting untuk JSON
                  },
                }
              )
                .then((response) => response.json())
                .then((result) => {
                  console.log("Result:", result);
                  if (result.success) {
                    Swal.fire(
                      "Sukses",
                      result.message || "Data berhasil disimpan",
                      "success"
                    );
                    window.location.href = "index.html";
                  } else {
                    Swal.fire(
                      "Gagal",
                      result.message || "Terjadi kesalahan",
                      "error"
                    );
                  }
                });
            } else {
              // Jika pengguna memilih "Tidak"
              Swal.fire("Dibatalkan", "Data tidak disimpan", "info");
            }
          });
        });
    </script>
  </body>
</html>
